# ИНСТРУКЦИЯ: Визуальные настройки категорий (как у брендов)

## Задача
Реализовать полный контроль визуального оформления категорий и подкатегорий товаров аналогично странице брендов (`/admin/brands`).

---

## Что нужно реализовать

### 1. База данных (D1)

Добавить в таблицу `categories` те же 12 колонок что и в `brands`:

```sql
-- Заливка фона (светлая тема)
ALTER TABLE categories ADD COLUMN bg_light_enabled INTEGER DEFAULT 0;
ALTER TABLE categories ADD COLUMN bg_light_color TEXT;
ALTER TABLE categories ADD COLUMN bg_light_opacity INTEGER DEFAULT 50;

-- Заливка фона (тёмная тема)
ALTER TABLE categories ADD COLUMN bg_dark_enabled INTEGER DEFAULT 0;
ALTER TABLE categories ADD COLUMN bg_dark_color TEXT;
ALTER TABLE categories ADD COLUMN bg_dark_opacity INTEGER DEFAULT 50;

-- Рамка (светлая тема)
ALTER TABLE categories ADD COLUMN border_light_enabled INTEGER DEFAULT 0;
ALTER TABLE categories ADD COLUMN border_light_color TEXT;
ALTER TABLE categories ADD COLUMN border_light_opacity INTEGER DEFAULT 100;

-- Рамка (тёмная тема)
ALTER TABLE categories ADD COLUMN border_dark_enabled INTEGER DEFAULT 0;
ALTER TABLE categories ADD COLUMN border_dark_color TEXT;
ALTER TABLE categories ADD COLUMN border_dark_opacity INTEGER DEFAULT 100;

-- Свечение при наведении (светлая тема)
ALTER TABLE categories ADD COLUMN glow_light_enabled INTEGER DEFAULT 0;
ALTER TABLE categories ADD COLUMN glow_light_color TEXT;
ALTER TABLE categories ADD COLUMN glow_light_opacity INTEGER DEFAULT 50;
ALTER TABLE categories ADD COLUMN glow_light_blur INTEGER DEFAULT 20;

-- Свечение при наведении (тёмная тема)
ALTER TABLE categories ADD COLUMN glow_dark_enabled INTEGER DEFAULT 0;
ALTER TABLE categories ADD COLUMN glow_dark_color TEXT;
ALTER TABLE categories ADD COLUMN glow_dark_opacity INTEGER DEFAULT 50;
ALTER TABLE categories ADD COLUMN glow_dark_blur INTEGER DEFAULT 20;

-- Скрытие названия
ALTER TABLE categories ADD COLUMN hide_name INTEGER DEFAULT 0;

-- Изображение категории (уже может быть)
-- image_url TEXT
```

### 2. Интерфейс Category (Frontend)

В файле где определяется интерфейс (например, `src/pages/Categories.tsx` или общий тип):

```typescript
interface Category {
  id: number;
  name_ru: string | null;
  name_fr: string | null;
  name_en: string | null;
  slug: string | null;
  parent_id: number | null;
  image_url: string | null;
  sort_order: number;
  hide_name?: boolean;
  
  // Заливка фона
  bg_light_enabled?: boolean;
  bg_light_color?: string | null;
  bg_light_opacity?: number | null;
  bg_dark_enabled?: boolean;
  bg_dark_color?: string | null;
  bg_dark_opacity?: number | null;
  
  // Рамка
  border_light_enabled?: boolean;
  border_light_color?: string | null;
  border_light_opacity?: number | null;
  border_dark_enabled?: boolean;
  border_dark_color?: string | null;
  border_dark_opacity?: number | null;
  
  // Свечение
  glow_light_enabled?: boolean;
  glow_light_color?: string | null;
  glow_light_opacity?: number | null;
  glow_light_blur?: number | null;
  glow_dark_enabled?: boolean;
  glow_dark_color?: string | null;
  glow_dark_opacity?: number | null;
  glow_dark_blur?: number | null;
}
```

### 3. API (worker/src/index.ts)

#### GET /api/categories (все категории)

```typescript
app.get('/api/categories', async (c) => {
  const { results } = await c.env.DB.prepare(`
    SELECT c.*, 
           p.name_${lang} as parent_name,
           (SELECT COUNT(*) FROM products p2 WHERE p2.category_id = c.id) as product_count
    FROM categories c
    LEFT JOIN categories p ON c.parent_id = p.id
    ORDER BY c.sort_order, c.name_fr
  `).all();
  
  return c.json({ success: true, data: results });
});
```

#### GET /api/categories/:id (одна категория)

```typescript
app.get('/api/categories/:id', async (c) => {
  const id = c.req.param('id');
  const { results } = await c.env.DB.prepare(`
    SELECT c.*, 
           p.name_${lang} as parent_name
    FROM categories c
    LEFT JOIN categories p ON c.parent_id = p.id
    WHERE c.id = ?
  `).bind(id).all();
  
  if (results.length === 0) {
    return c.json({ success: false, error: 'Category not found' }, { status: 404 });
  }
  return c.json({ success: true, data: results[0] });
});
```

#### POST /api/categories

```typescript
app.post('/api/categories', async (c) => {
  const body = await c.req.json();
  const { 
    name_ru, name_fr, name_en, slug, parent_id, image_url, sort_order,
    hide_name,
    bg_light_enabled, bg_light_color, bg_light_opacity,
    bg_dark_enabled, bg_dark_color, bg_dark_opacity,
    border_light_enabled, border_light_color, border_light_opacity,
    border_dark_enabled, border_dark_color, border_dark_opacity,
    glow_light_enabled, glow_light_color, glow_light_opacity, glow_light_blur,
    glow_dark_enabled, glow_dark_color, glow_dark_opacity, glow_dark_blur
  } = body;

  try {
    const result = await c.env.DB.prepare(`
      INSERT INTO categories (
        name_ru, name_fr, name_en, slug, parent_id, image_url, sort_order,
        hide_name,
        bg_light_enabled, bg_light_color, bg_light_opacity,
        bg_dark_enabled, bg_dark_color, bg_dark_opacity,
        border_light_enabled, border_light_color, border_light_opacity,
        border_dark_enabled, border_dark_color, border_dark_opacity,
        glow_light_enabled, glow_light_color, glow_light_opacity, glow_light_blur,
        glow_dark_enabled, glow_dark_color, glow_dark_opacity, glow_dark_blur
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(
      name_ru || null, name_fr || null, name_en || null, slug || null, 
      parent_id || null, image_url || null, sort_order || 0,
      hide_name ? 1 : 0,
      bg_light_enabled ? 1 : 0, bg_light_color || null, bg_light_opacity || 50,
      bg_dark_enabled ? 1 : 0, bg_dark_color || null, bg_dark_opacity || 50,
      border_light_enabled ? 1 : 0, border_light_color || null, border_light_opacity || 100,
      border_dark_enabled ? 1 : 0, border_dark_color || null, border_dark_opacity || 100,
      glow_light_enabled ? 1 : 0, glow_light_color || null, glow_light_opacity || 50, glow_light_blur || 20,
      glow_dark_enabled ? 1 : 0, glow_dark_color || null, glow_dark_opacity || 50, glow_dark_blur || 20
    ).run();

    return c.json({ success: true, data: { id: result.meta?.last_row_id } });
  } catch (error: any) {
    return c.json({ success: false, error: error.message }, { status: 400 });
  }
});
```

#### PUT /api/categories/:id

Аналогично POST, но с WHERE id = ?

#### DELETE /api/categories/:id

Стандартный DELETE

### 4. Admin страница категорий (src/pages/AdminCategories.tsx)

Создать/обновить страницу управления категориями с визуальными настройками.

**Структура:**
1. Список категорий (сетка или таблица)
2. Кнопка "Добавить категорию"
3. Модальное окно с 2 режимами:
   - Базовые настройки (название, slug, родительская категория, изображение)
   - Визуальные настройки (кнопка "Налаштування відображення")

**Главный контейнер:**
```tsx
<div className={`relative w-full ${showVisualSettings ? 'max-w-5xl' : 'max-w-2xl'} p-6 border ${borderClass} rounded-xl ${isLight ? 'bg-white' : 'bg-zinc-900'} my-8`}>
```

**Кнопка настроек:**
```tsx
<button
  onClick={() => setShowVisualSettings(!showVisualSettings)}
  className={`ml-auto flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold uppercase tracking-wide rounded-lg transition-colors ${
    showVisualSettings 
      ? 'bg-[#FF6B00] text-black' 
      : 'border border-[#FF6B00] text-[#FF6B00] hover:bg-[#FF6B00]/10'
  }`}
>
  <Settings className="w-3.5 h-3.5" />
  Налаштування відображення
</button>
```

**Панель визуальных настроек (справа):**
```tsx
<AnimatePresence>
  {showVisualSettings && (
    <motion.div
      initial={{ opacity: 0, x: 50 }}
      animate={{ opacity: 1, x: 0 }}
      exit={{ opacity: 0, x: 50 }}
      className="w-1/2 border-l border-dashed border-[#FF6B00]/30 pl-6"
    >
      {/* Все 4 секции настроек:
          1. Заливка - Светлая тема
          2. Заливка - Тёмная тема
          3. Рамка - Светлая тема
          4. Рамка - Тёмная тема
          5. Свечение - Светлая тема
          6. Свечение - Тёмная тема
      */}
    </motion.div>
  )}
</AnimatePresence>
```

**Импорты:**
```typescript
import { Settings, Zap } from 'lucide-react';
```

### 5. Публичная страница каталога (src/pages/Catalogue.tsx)

Применить визуальные настройки к карточкам категорий.

**Структура категории:**
```tsx
<a
  href={`/catalogue/${category.slug || category.id}`}
  className="group relative flex flex-col items-center justify-center h-[160px] sm:h-[180px] md:h-[200px] p-2 sm:p-3 md:p-4 rounded-lg sm:rounded-xl border transition-all duration-300"
  style={{
    backgroundColor: isLight 
      ? (category.bg_light_enabled && category.bg_light_color 
          ? `${category.bg_light_color}${Math.round((category.bg_light_opacity || 50) * 2.55).toString(16).padStart(2, '0')}`
          : 'transparent')
      : (category.bg_dark_enabled && category.bg_dark_color
          ? `${category.bg_dark_color}${Math.round((category.bg_dark_opacity || 50) * 2.55).toString(16).padStart(2, '0')}`
          : 'transparent'),
    borderColor: isLight
      ? (category.border_light_enabled && category.border_light_color 
          ? `${category.border_light_color}${Math.round((category.border_light_opacity || 100) * 2.55).toString(16).padStart(2, '0')}`
          : 'transparent')
      : (category.border_dark_enabled && category.border_dark_color
          ? `${category.border_dark_color}${Math.round((category.border_dark_opacity || 100) * 2.55).toString(16).padStart(2, '0')}`
          : 'transparent'),
    borderWidth: ((isLight && category.border_light_enabled) || (!isLight && category.border_dark_enabled)) ? '2px' : '1px',
  }}
  onMouseEnter={(e) => {
    const glowEnabled = isLight 
      ? category.glow_light_enabled && category.glow_light_color 
      : category.glow_dark_enabled && category.glow_dark_color;
    const glowColor = isLight ? category.glow_light_color : category.glow_dark_color;
    const glowOpacity = isLight ? (category.glow_light_opacity || 50) : (category.glow_dark_opacity || 50);
    const glowBlur = isLight ? (category.glow_light_blur || 20) : (category.glow_dark_blur || 20);
    
    if (glowEnabled && glowColor) {
      e.currentTarget.style.transition = 'box-shadow 300ms ease';
      e.currentTarget.style.boxShadow = `0 0 ${glowBlur}px ${glowColor}${Math.round(glowOpacity * 2.55).toString(16).padStart(2, '0')}`;
    }
  }}
  onMouseLeave={(e) => {
    e.currentTarget.style.transition = 'box-shadow 300ms ease';
    e.currentTarget.style.boxShadow = 'none';
  }}
>
  {/* Изображение или название */}
  {!category.hide_name && (
    <h3 className={`font-bold italic text-[11px] sm:text-sm uppercase tracking-wide ${textClass} group-hover:text-[#FF6B00] transition-colors`}>
      {getCategoryName(category)}
    </h3>
  )}
</a>
```

### 6. Ссылки для вдохновения

**AdminBrands.tsx (существующий):**
- `C:\Users\Asus\Desktop\projekts\Artur\YansDeco\src\pages\AdminBrands.tsx`
- Использовать как шаблон для AdminCategories.tsx

**Worker API (brands):**
- `C:\Users\Asus\Desktop\projekts\Artur\YansDeco\worker\src\index.ts` (строки ~176-310)
- Скопировать логику INSERT/UPDATE/SELECT для categories

**Marques.tsx (публичная страница брендов):**
- `C:\Users\Asus\Desktop\projekts\Artur\YansDeco\src\pages\Marques.tsx`
- Логика применения box-shadow при hover

### 7. Файлы для изменения

| Файл | Действие |
|------|----------|
| `worker/src/index.ts` | Добавить API эндпоинты для categories |
| `src/pages/AdminCategories.tsx` | Создать/обновить с визуальными настройками |
| `src/pages/Catalogue.tsx` | Применить стили к карточкам категорий |
| `information/memory2.txt` | Добавить документацию |
| База D1 | Выполнить миграцию (12 колонок) |

### 8. Тестирование

1. Добавить категорию с заливкой, рамкой и свечением
2. Проверить отображение на светлой теме
3. Проверить отображение на тёмной теме
4. Проверить hover эффект (свечение)
5. Проверить скрытие названия (hide_name)

---

## Важные моменты

1. **Генерация slug** - если slug не указан, генерировать из name_fr
2. **Иерархия** - категории могут иметь parent_id (подкатегории)
3. **Изображение** - загрузка через тот же API `/api/upload`
4. **Сортировка** - поле sort_order для порядка отображения
5. **Мультиязычность** - name_ru, name_fr, name_en

---

## Время реализации

- API: 30 минут
- Admin страница: 1-2 часа
- Публичная страница: 30 минут
- Тестирование: 30 минут

**Итого: ~3-4 часа**
